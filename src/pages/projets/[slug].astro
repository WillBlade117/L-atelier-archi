---
import Layout from '../../layouts/Layout.astro';
import BeforeAfter from '../../components/BeforeAfter.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={entry.data.title}>
  <main class="pt-32 pb-24 bg-primary-900">
    <div class="max-w-screen-xl mx-auto px-6 md:px-12">
      
      <a href="/projets" class="text-accent-gold hover:text-white transition-colors mb-8 inline-block">
        &larr; Retour aux réalisations
      </a>

      <header class="mb-12">
        <h1 class="text-5xl md:text-7xl font-serif text-white mb-6">{entry.data.title}</h1>
        <div class="flex flex-wrap gap-6 text-gray-400 font-sans border-y border-white/10 py-6">
          <div class="flex flex-col">
            <span class="text-xs uppercase tracking-widest text-accent-gold mb-1">Localisation</span>
            <span class="text-white">{entry.data.location}</span>
          </div>
          <div class="flex flex-col">
            <span class="text-xs uppercase tracking-widest text-accent-gold mb-1">Surface</span>
            <span class="text-white">{entry.data.surface || 'N/C'}</span>
          </div>
          <div class="flex flex-col">
            <span class="text-xs uppercase tracking-widest text-accent-gold mb-1">Type</span>
            <span class="text-white">{entry.data.category}</span>
          </div>
        </div>
      </header>

      {entry.data.beforeImage && entry.data.afterImage ? (
        <section class="mb-20">
          <h2 class="text-2xl font-serif text-white mb-8 text-center italic">La Métamorphose</h2>
          <BeforeAfter 
            beforeImage={entry.data.beforeImage} 
            afterImage={entry.data.afterImage} 
            altText={entry.data.title}
          />
        </section>
      ) : (
        <Image src={entry.data.coverImage} alt={entry.data.title} class="w-full rounded-lg shadow-2xl mb-20" />
      )}

      <article class="prose prose-invert prose-gold max-w-3xl mx-auto mt-16 font-sans leading-relaxed text-gray-300">
        <Content />
      </article>

      {entry.data.gallery && entry.data.gallery.length > 0 && (
        <section class="mt-32">
          <div class="flex items-center gap-4 mb-12">
            <div class="h-px flex-1 bg-white/10"></div>
            <h2 class="text-2xl font-serif text-white italic">Galerie du projet</h2>
            <div class="h-px flex-1 bg-white/10"></div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
            {entry.data.gallery.map((img, index) => (
              <div class={`overflow-hidden bg-primary-800 ${
                index % 5 === 0 ? 'lg:col-span-4 lg:row-span-2' : 'lg:col-span-2'
              }`}>
                <Image 
                  src={img} 
                  alt={`Détail ${index + 1} - ${entry.data.title}`} 
                  class="w-full h-full object-cover grayscale hover:grayscale-0 transition-all duration-700 hover:scale-105"
                />
              </div>
            ))}
          </div>
        </section>
      )}

    </div>
  </main>
</Layout>